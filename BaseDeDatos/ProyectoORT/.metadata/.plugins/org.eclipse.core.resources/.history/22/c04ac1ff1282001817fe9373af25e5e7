Create or Replace Procedure ESQUEMA.SP_Prestamos_ObtenerPK(
IN P_LIBROS_CODIGO VARCHAR(12),
IN P_PERSONAS_CEDULA VARCHAR(10),
IN P_PRESTAMOS_FECHA_DESDE DATE,
IN P_PRESTAMOS_FECHA_HASTA DATE
)
DYNAMIC RESULT SETS 1

P1:Begin

DECLARE c1 CURSOR WITH RETURN FOR Select 
PRESTAMOS.LIBROS_CODIGO,
PRESTAMOS.PERSONAS_CEDULA,
CHAR(PRESTAMOS_FECHA_DESDE, ISO) as PRESTAMOS_FECHA_DESDE,
CHAR(PRESTAMOS_FECHA_HASTA, ISO) as PRESTAMOS_FECHA_HASTA,
LIBROS.LIBROS_CODIGO,
LIBROS.LIBROS_TITULO,
LIBROS.LIBROS_ISBN,
LIBROS.LIBROS_ANIO,
LIBROS.LIBROS_DESCRIPCION,
LIBROS.LIBROS_DISPONIBLE,
LIBROS.TIPOS_CODIGO,
PERSONAS.PERSONAS_CEDULA,
PERSONAS.PERSONAS_MAIL,
PERSONAS.PERSONAS_NOMBRE
from 
ESQUEMA.PRESTAMOS PRESTAMOS, 
ESQUEMA.LIBROS LIBROS, 
ESQUEMA.PERSONAS PERSONAS 
WHERE
	prestamos.LIBROS_CODIGO = libros.LIBROS_CODIGO 
	and  prestamos.PERSONAS_CEDULA = personas.PERSONAS_CEDULA
	
	and PRESTAMOS.LIBROS_CODIGO=P_LIBROS_CODIGO,
	and PRESTAMOS.PERSONAS_CEDULA=P_PERSONAS_CEDULA,
	and PRESTAMOS.PRESTAMOS_FECHA_DESDE=P_PRESTAMOS_FECHA_DESDE,
	and PRESTAMOS.PRESTAMOS_FECHA_HASTA=P_PRESTAMOS_FECHA_HASTA
	
	;
OPEN C1;

End p1